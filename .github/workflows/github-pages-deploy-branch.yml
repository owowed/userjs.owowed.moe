name: Github Pages Deploy Branch

# on:
#   push:
#     branches:
#       - main
on: workflow_dispatch

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Check out main repo
        uses: actions/checkout@v3

      - name: Check out userscript-common
        uses: actions/checkout@v3
        with:
          repository: owowed/userscript-common
          path: public/common

      - name: Check out owowed-userscripts
        uses: actions/checkout@v3
        with:
          repository: owowed/owowed-userscripts
          path: public/scripts

      - name: .git folder cleanup
        run: find public -type d -name ".git" -exec rm -rf {} +
          
      - name: Generate Directory Listings
        uses: jayanta525/github-pages-directory-listing@v3.0.0
        with:
          FOLDER: public

      - name: Run tree
        run: tree
    
      - name: Deploy to GitHub Pages
        if: success()
        uses: crazy-max/ghaction-github-pages@v3
        with:
            fqdn: userjs.owowed.moe
            target_branch: gh-pages
            build_dir: public
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
